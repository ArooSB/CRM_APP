<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support Tickets</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: auto;
            background: #fff;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        h1, h2 {
            color: #333;
        }

        label {
            display: block;
            margin: 10px 0 5px;
        }

        input, textarea, select {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
        }

        button:hover {
            background: #0056b3;
        }

        .ticket {
            border: 1px solid #ccc;
            border-radius: 5px;
            margin: 10px 0;
            padding: 10px;
        }

        .ticket h3 {
            margin: 0 0 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Support Tickets</h1>

        <div id="ticket-form">
            <h2>Create Support Ticket</h2>
            <form id="create-ticket-form">
                <label for="customer_id">Customer ID:</label>
                <input type="number" id="customer_id" required>

                <label for="description">Description:</label>
                <textarea id="description" required></textarea>

                <label for="status">Status:</label>
                <select id="status" required>
                    <option value="open">Open</option>
                    <option value="in progress">In Progress</option>
                    <option value="closed">Closed</option>
                </select>

                <button type="submit">Create Ticket</button>
            </form>
        </div>

        <h2>Existing Support Tickets</h2>
        <div id="support-tickets"></div>
    </div>

    <script>
        const apiUrl = 'http://localhost:5000/support_tickets'; // Adjust the URL as necessary

        document.addEventListener('DOMContentLoaded', function () {
            loadSupportTickets();

            document.getElementById('create-ticket-form').addEventListener('submit', function (event) {
                event.preventDefault();
                createSupportTicket();
            });
        });

        function loadSupportTickets() {
            fetch(apiUrl, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                }
            })
            .then(response => response.json())
            .then(data => {
                const supportTicketsDiv = document.getElementById('support-tickets');
                supportTicketsDiv.innerHTML = '';

                data.support_tickets.forEach(ticket => {
                    const ticketDiv = document.createElement('div');
                    ticketDiv.className = 'ticket';
                    ticketDiv.innerHTML = `
                        <h3>Ticket ID: ${ticket.id}</h3>
                        <p>Customer ID: ${ticket.customer_id}</p>
                        <p>Description: ${ticket.description}</p>
                        <p>Status: ${ticket.status}</p>
                        <p>Created At: ${ticket.created_at}</p>
                        <button onclick="deleteSupportTicket(${ticket.id})">Delete Ticket</button>
                    `;
                    supportTicketsDiv.appendChild(ticketDiv);
                });
            })
            .catch(error => console.error('Error fetching support tickets:', error));
        }

        function createSupportTicket() {
            const customerId = document.getElementById('customer_id').value;
            const description = document.getElementById('description').value;
            const status = document.getElementById('status').value;

            const ticketData = {
                customer_id: customerId,
                description: description,
                status: status
            };

            fetch(apiUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                },
                body: JSON.stringify(ticketData)
            })
            .then(response => {
                if (response.ok) {
                    return response.json();
                }
                throw new Error('Failed to create ticket');
            })
            .then(data => {
                alert(data.message);
                loadSupportTickets();
                document.getElementById('create-ticket-form').reset();
            })
            .catch(error => console.error('Error creating support ticket:', error));
        }

        function deleteSupportTicket(id) {
            fetch(`${apiUrl}/${id}`, {
                method: 'DELETE',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                }
            })
            .then(response => {
                if (response.ok) {
                    alert('Ticket deleted successfully');
                    loadSupportTickets();
                } else {
                    alert('Failed to delete ticket');
                }
            })
            .catch(error => console.error('Error deleting support ticket:', error));
        }
    </script>
</body>
</html>
